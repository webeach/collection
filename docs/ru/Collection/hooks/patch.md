# `patch:*`

## Описание

Хуки `patch:before` и `patch:after` срабатывают при обновлении существующего элемента в коллекции.

- `patch:before` вызывается **до** применения изменений к элементу.
- `patch:after` вызывается **после** успешного применения изменений.

Хуки позволяют перехватывать процесс патчинга, проверять изменения или выполнять дополнительные действия.

---

## Синтаксис хука

```ts
hook({
  item,
  index,
  meta,
}): boolean | void;
```

- **item** — элемент, который будет изменён.
- **index** — индекс элемента в коллекции.
- **meta** — мета-информация коллекции (например, ключ первичного поля).
- **Возвращаемое значение**:
  - Если `patch:before` возвращает `false`, операция патчинга отменяется.
  - `patch:after` не влияет на ход операции.

---

## Поведение

- `patch:before` может заблокировать обновление элемента, вернув `false`.
- `patch:after` вызывается всегда после успешного обновления.
- Хуки вызываются в порядке их регистрации.

---

## Примеры

### Блокировка изменений по условию

```ts
collection[$CollectionHookDispatcherSymbol].register(
  "patch:before",
  ({ item }) => {
    if (item.readonly) {
      return false; // Запрещаем изменять защищённые элементы
    }
  },
);
```

### Логирование успешного изменения

```ts
collection[$CollectionHookDispatcherSymbol].register(
  "patch:after",
  ({ item, index, meta }) => {
    console.log(
      `Элемент с ключом ${item[meta.primaryKey]} обновлён на позиции ${index}`,
    );
  },
);
```

### Мутация элемента после успешного патчинга

```ts
collection[$CollectionHookDispatcherSymbol].register(
  "patch:after",
  ({ item }) => {
    item.updatedAt = new Date(); // Добавляем поле времени обновления
  },
);
```
